# Lisa load testing

不是为了压爆server/database而load testing，是为接近现实的场景，模拟用户行为，预测期望性能指标的过程，这是一个持续迭代的事情，贯穿产品生命周期。
> 当然如果需要预测临界值，那么要做的事情更多更多。

## 术语

* OK -> 成功数
* KO -> 失败数
* KO% -> 失败率
* Min/Mean/Max -> 最小响应时间/平均/最大 (ms)

## 目标

QPS>??, TP99>??, TP95>??, TP90>??, TP50>??.. AVG.

> 在SUP环境

## 场景

主要测试场景涵盖EPC主流程，遵循Open Model，尽可能贴近现实使用场景，逐步加量来接近真相，得到更准确、更有价值的结果

> 初步流程设计为初始n个virtual users, 按照每秒+n个virtual user的速率, 持续n min
目前设计中没有太多考虑thinking time

- [x] 扫码 
- [x] 查询盘柜
- [x] 录入盘柜
- [x] 录入设备
- [x] 创建cloud>查询cloud
- [x] 创建cloud>创建TH150M>组网>查询点位模板>获取报警信息
- [x] 创建hub>非白名单组网60个TH150S
- [ ] 盘柜操作记录
- [ ] 网关操作记录

## 实现

by [Gatling](https://gatling.io/)

> Gatling可以做到持续集成，也可以本地run，报告以html格式生成，命令行也有summary/detail

## Report

* 扫码

| 测试时间   |                                                       | 并发/QPS    | Total/OK/KO/KO%  | Min/Mean/Max | TP99 | TP95 | TP75 | TP50 | Error |
| ---------- | ----------------------------------------------------- | ----------- | ---------------- | ------------ | ---- | ---- | ---- | ---- | ----- |
| 2021/01/26 | 初始5,repeat 10,持续3min,5-20速率每秒,thinking time=0 | 60+/149.448 | 27050/27050/0/0% | 50/138/1314  | 338  | 262  | 179  | 128  |       |
* 查询盘柜

| 测试时间   |                                                              | 并发/QPS    | Total/OK/KO/KO% | Min/Mean/Max  | TP99 | TP95 | TP75 | TP50 | Error |
| ---------- | ------------------------------------------------------------ | ----------- | --------------- | ------------- | ---- | ---- | ---- | ---- | ----- |
| 2021/01/26 | 初始1,repeat 10,持续2min,每秒增加5左右virtual user,thinking time=1s | 250+/38.839 | 6020/6020/0/0%  | 112/2889/5951 | 5586 | 5312 | 3934 | 3132 |       |

* 录入盘柜

| 测试时间   |                                                              | 并发/QPS    | Total/OK/KO/KO% | Min/Mean/Max    | TP99  | TP95  | TP75  | TP50  | Error |
| ---------- | ------------------------------------------------------------ | ----------- | --------------- | --------------- | ----- | ----- | ----- | ----- | ----- |
| 2021/01/26 | 初始1,repeat 10,持续2min,每秒增加3左右virtual user,无thinking time | 300+/12.155 | 3610/3610/0/0%  | 467/18159/28373 | 27490 | 26851 | 23738 | 20196 |       |

* 录入设备

| 测试时间   |                                                              | 并发/QPS  | Total/OK/KO/KO% | Min/Mean/Max | TP99 | TP95 | TP75 | TP50 | Error |
| ---------- | ------------------------------------------------------------ | --------- | --------------- | ------------ | ---- | ---- | ---- | ---- | ----- |
| 2021/01/26 | 初始1,repeat 10,持续2min,每秒增加3左右virtual user,无thinking time | 15+/29.59 | 3610/3610/0/0%  | 76/171/638   | 445  | 337  | 218  | 144  |       |

* 保存cloud > 查询cloud

| 测试时间   |                                                              | QPS        | Total/OK/KO/KO% | Min/Mean/Max | TP99 | TP95 | TP75 | TP50 | Error |
| ---------- | ------------------------------------------------------------ | ---------- | --------------- | ------------ | ---- | ---- | ---- | ---- | ----- |
| 2021/01/26 | 初始1,repeat 10,持续2min,每秒增加3左右virtual user,无thinking time | 40+/58.226 | 7220/7220/0/0%  | 81/300/1709  | 756  | 590  | 399  | 271  |       |

* 保存cloud > 录入设备 > 组网1个150M > 获取点位模板 > 获取报警

| 测试时间   |                                                              | 并发/QPS    | Total/OK/KO/KO%  | Min/Mean/Max  | TP99  | TP95  | TP75 | TP50 | Error |
| ---------- | ------------------------------------------------------------ | ----------- | ---------------- | ------------- | ----- | ----- | ---- | ---- | ----- |
| 2021/01/26 | 初始1,repeat 10,持续2min,每秒增加3左右virtual user,无thinking time | 360+/58.226 | 21660/21660/0/0% | 59/4372/23546 | 22291 | 19630 | 4402 | 2078 |       |

* 保存hub > 组网60个150S

| 测试时间   |                                                              | 并发/QPS   | Total/OK/KO/KO%   | Min/Mean/Max    | TP99   | TP95   | TP75   | TP50  | Error                                                        |
| ---------- | ------------------------------------------------------------ | ---------- | ----------------- | --------------- | ------ | ------ | ------ | ----- | ------------------------------------------------------------ |
| 2021/01/26 | 初始1,repeat 5,持续2min,每秒增加3左右virtual user,无thinking time | 360+/2.418 | 3610/2714/896/25% | 42/61188/675477 | 152401 | 152106 | 147180 | 38906 | ---- Errors --------------------------------------------------------------------<br/>> j.i.IOException: Premature close                                  891 (99.44%)<br/>> i.g.h.c.i.RequestTimeoutException: Request timeout to 172.26.2      5 ( 0.56%)<br/>09.35/172.26.209.35:9000 after 600000 ms |

- 保存swofkit

| 测试时间  |                                                         | 并发/QPS   | Total/OK/KO/KO% | Min/Mean/Max | TP99 | TP95 | TP75 | TP50 | Error |
| --------- | ------------------------------------------------------- | ---------- | --------------- | ------------ | ---- | ---- | ---- | ---- | ----- |
| 2021/02/4 | 初始1,repeat 10,30秒增加50virtual user,thinking time=1s | 20+/12.439 | 510/510/0/0%    | 93/133/285   | 265  | 203  | 149  | 120  |       |

- 保存cloud > 保存150s > 并且组网一个150S

| 测试时间  |                                                         | 并发/QPS   | Total/OK/KO/KO% | Min/Mean/Max | TP99 | TP95 | TP75 | TP50 | Error |
| --------- | ------------------------------------------------------- | ---------- | --------------- | ------------ | ---- | ---- | ---- | ---- | ----- |
| 2021/02/4 | 初始1,repeat 10,30秒增加50virtual user,thinking time=1s | 46+/39.231 | 2040/2040/0/0%  | 91/396/1943  | 1524 | 1226 | 447  | 231  |       |